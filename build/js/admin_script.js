function on_ready(){$(".add_item").click(function(){var e=this,t=$(this).parent(),a=$(t).find(".template").first().clone().removeClass("template");$(a).find("input").val(""),$(t).append(a),$(a).insertBefore(e),update_remove_listener()}),update_remove_listener()}function update_remove_listener(){$(".remove_item").click(function(){var e=$(this).parent(),t=$(e).parent().children().length-2;t>1&&$(e).remove()}),$(".image_list_item .remove_item").click(function(){var e=$(this).attr("image_id");if(void 0!=e){var t="<input value = "+e+" type =  'hidden' name = 'removed_images[]'>";$("#form").append(t)}})}function compress_image(e){e=e||window.event;var t=e.target||e.srcElement,a=t.parentNode,n=t.name,r=t.files[0];if(void 0!=r){var i=r.type,d=get_filename_from_path(t.value),m=$(t).attr("image_id");void 0==m&&(m="none");var o=document.createElement("img");o.className+="always_hidden",o.className+=" tmp_holder",o.setAttribute("holder_name",n),o.setAttribute("filename",d),o.setAttribute("image_id",m);$(a).find(".tmp_holder[holder_name='"+n+"']").remove();$(a).append(o);var l=new FileReader;l.onload=function(e){o.src=e.target.result,o.setAttribute("mime",i)},l.readAsDataURL(r)}else $("[holder_name='"+n+"']").remove()}function send_form(){for(var e=new FormData(document.getElementById("form")),t=document.getElementsByClassName("tmp_holder"),a=0;a<t.length;a++){var n=t[a],r=n.getAttribute("holder_name"),i=n.getAttribute("mime"),d=n.naturalWidth,m=n.naturalHeight,o=m/d;d>maxWidth&&(d=maxWidth,m=o*maxWidth);var l="";if("image/png"!=i){var s=.9,c=document.createElement("canvas");c.width=d,c.height=m;var h=c.getContext("2d");h.drawImage(n,0,0,d,m),l=c.toDataURL(i,s)}else l=n.src;var u=$(n).attr("filename"),v=$(n).attr("image_id");l+="@)(@#!#!#"+u+"@)(@#!#!#"+v,"[]"!=r.substring(r.length-2,r.length)&&e.delete(r),e.append(r,l)}var g=$.ajax({url:"add_product.php",type:"POST",data:e,cache:!1,contentType:!1,processData:!1});g.success(function(e){window.location.replace("admin?message=Product has been added or edited")})}function compressPNG(e,t,a){var n=e.naturalWidth,r=e.naturalHeight,i=document.createElement("canvas");i.width=n*t,i.height=r*t;var d=i.getContext("2d");d.drawImage(e,0,0,i.width,i.height);var m=document.createElement("img");m.src=i.toDataURL(a);var o=document.createElement("canvas");o.width=n,o.height=r;var l=o.getContext("2d");console.log(typeof m),console.log(typeof e),l.drawImage(m,0,0,o.width,o.height);var s=o.toDataURL(a);return s}function get_filename_from_path(e){if(e){var t=e.indexOf("\\")>=0?e.lastIndexOf("\\"):e.lastIndexOf("/"),a=e.substring(t);0!==a.indexOf("\\")&&0!==a.indexOf("/")||(a=a.substring(1))}return a}$(document).ready(on_ready);var maxWidth=1e3;