function on_ready(){$(".add_item").click(function(){var a=this,b=$(this).parent(),c=$(b).find(".template").first().clone().removeClass("template");$(c).find("input").val(""),$(b).append(c),$(c).insertBefore(a),update_remove_listener()}),update_remove_listener()}function update_remove_listener(){$(".remove_item").click(function(){var a=$(this).parent(),b=$(a).parent().children().length-2;b>1&&$(a).remove()}),$(".image_list_item .remove_item").click(function(){var a=$(this).attr("image_id");if(void 0!=a){var b="<input value = "+a+" type =  'hidden' name = 'removed_images[]'>";$("#form").append(b)}})}function compress_image(a){a=a||window.event;var b=a.target||a.srcElement,c=b.parentNode,d=b.name,e=b.files[0];if(void 0!=e){var f=e.type,g=get_filename_from_path(b.value),h=$(b).attr("image_id");void 0==h&&(h="none");var i=document.createElement("img");i.className+="always_hidden",i.className+=" tmp_holder",i.setAttribute("holder_name",d),i.setAttribute("filename",g),i.setAttribute("image_id",h);$(c).find(".tmp_holder[holder_name='"+d+"']").remove();$(c).append(i);var j=new FileReader;j.onload=function(a){i.src=a.target.result,i.setAttribute("mime",f)},j.readAsDataURL(e)}else $("[holder_name='"+d+"']").remove()}function send_form(){for(var a=new FormData(document.getElementById("form")),b=document.getElementsByClassName("tmp_holder"),c=0;c<b.length;c++){var d=b[c],e=d.getAttribute("holder_name"),f=d.getAttribute("mime"),g=d.naturalWidth,h=d.naturalHeight,i=h/g;g>maxWidth&&(g=maxWidth,h=i*maxWidth);var j="";if("image/png"!=f){var k=.9,l=document.createElement("canvas");l.width=g,l.height=h;var m=l.getContext("2d");m.drawImage(d,0,0,g,h),j=l.toDataURL(f,k)}else j=d.src;var n=$(d).attr("filename"),o=$(d).attr("image_id");j+="@)(@#!#!#"+n+"@)(@#!#!#"+o,"[]"!=e.substring(e.length-2,e.length)&&a.delete(e),a.append(e,j)}var p=$.ajax({url:"add_product.php",type:"POST",data:a,cache:!1,contentType:!1,processData:!1});p.success(function(a){window.location.replace("admin?message=Product has been added or edited")})}function compressPNG(a,b,c){var d=a.naturalWidth,e=a.naturalHeight,f=document.createElement("canvas");f.width=d*b,f.height=e*b;var g=f.getContext("2d");g.drawImage(a,0,0,f.width,f.height);var h=document.createElement("img");h.src=f.toDataURL(c);var i=document.createElement("canvas");i.width=d,i.height=e;var j=i.getContext("2d");console.log(typeof h),console.log(typeof a),j.drawImage(h,0,0,i.width,i.height);var k=i.toDataURL(c);return k}function get_filename_from_path(a){if(a){var b=a.indexOf("\\")>=0?a.lastIndexOf("\\"):a.lastIndexOf("/"),c=a.substring(b);0!==c.indexOf("\\")&&0!==c.indexOf("/")||(c=c.substring(1))}return c}$(document).ready(on_ready);var maxWidth=1e3;